<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gehad Team - Troubleshooting</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">ğŸ” Gehad Team - ÙØ­Øµ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>

        <div class="space-y-6">
            <!-- Environment Check -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <span>âš™ï¸</span> ÙØ­Øµ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©
                </h2>
                
                <div class="space-y-3">
                    <div class="flex items-center justify-between bg-gray-700 p-3 rounded">
                        <span>NEXT_PUBLIC_SUPABASE_URL</span>
                        <span id="supabase-url" class="text-yellow-400">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</span>
                    </div>
                    
                    <div class="flex items-center justify-between bg-gray-700 p-3 rounded">
                        <span>NEXT_PUBLIC_SUPABASE_ANON_KEY</span>
                        <span id="supabase-key" class="text-yellow-400">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</span>
                    </div>
                    
                    <div class="flex items-center justify-between bg-gray-700 p-3 rounded">
                        <span>NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY</span>
                        <span id="clerk-key" class="text-yellow-400">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</span>
                    </div>
                </div>
            </div>

            <!-- Clerk Session Check -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <span>ğŸ”</span> ÙØ­Øµ Ø¬Ù„Ø³Ø© Clerk
                </h2>
                
                <div class="space-y-3">
                    <div class="flex items-center justify-between bg-gray-700 p-3 rounded">
                        <span>Ø§Ù„Ø­Ø§Ù„Ø©</span>
                        <span id="clerk-session" class="text-yellow-400">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</span>
                    </div>
                    
                    <div class="flex items-center justify-between bg-gray-700 p-3 rounded">
                        <span>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span>
                        <span id="clerk-user-id" class="text-yellow-400">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</span>
                    </div>
                </div>
                
                <button 
                    onclick="testClerkToken()"
                    class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded"
                >
                    ÙØ­Øµ JWT Token
                </button>
                
                <div id="token-result" class="mt-4 hidden">
                    <div class="bg-gray-700 p-3 rounded">
                        <h3 class="font-semibold mb-2">Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙˆÙƒÙ†:</h3>
                        <div id="token-details" class="text-sm"></div>
                    </div>
                </div>
            </div>

            <!-- Supabase Connection Check -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <span>ğŸ—„ï¸</span> ÙØ­Øµ Ø§ØªØµØ§Ù„ Supabase
                </h2>
                
                <div class="space-y-3">
                    <div class="flex items-center justify-between bg-gray-700 p-3 rounded">
                        <span>Ø§Ù„Ø­Ø§Ù„Ø©</span>
                        <span id="supabase-status" class="text-yellow-400">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</span>
                    </div>
                </div>
                
                <button 
                    onclick="testSupabaseConnection()"
                    class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded"
                >
                    Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
                </button>
                
                <div id="supabase-result" class="mt-4 hidden">
                    <div class="bg-gray-700 p-3 rounded">
                        <h3 class="font-semibold mb-2">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h3>
                        <div id="supabase-details" class="text-sm"></div>
                    </div>
                </div>
            </div>

            <!-- SQL Instructions -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <span>ğŸ“</span> ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
                </h2>
                
                <div class="space-y-4">
                    <div class="bg-gray-700 p-4 rounded">
                        <h3 class="font-semibold mb-2 text-blue-400">1. ØªØ­Ù‚Ù‚ Ù…Ù† JWT Template ÙÙŠ Clerk</h3>
                        <ol class="list-decimal list-inside space-y-1 text-sm">
                            <li>Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ <a href="https://dashboard.clerk.com" target="_blank" class="text-blue-400 hover:underline">Clerk Dashboard</a></li>
                            <li>Ø§Ø®ØªØ± ØªØ·Ø¨ÙŠÙ‚Ùƒ</li>
                            <li>Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ <strong>JWT Templates</strong></li>
                            <li>Ø£Ù†Ø´Ø¦ Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³Ù… <code class="bg-gray-600 px-1 rounded">supabase</code></li>
                            <li>Ø£Ø¶Ù Ø§Ù„Ù€ Claims Ø§Ù„ØªØ§Ù„ÙŠØ©:</li>
                        </ol>
                        <pre class="bg-gray-900 p-3 rounded mt-2 text-xs overflow-x-auto"><code>{
  "role": "authenticated",
  "user_id": "https://www.clerk.com/v1/user/{{user.id}}",
  "email": "{{user.primaryEmailAddress?.emailAddress}}"
}</code></pre>
                    </div>
                    
                    <div class="bg-gray-700 p-4 rounded">
                        <h3 class="font-semibold mb-2 text-green-400">2. ØªØ¹Ø·ÙŠÙ„ RLS Ù…Ø¤Ù‚ØªØ§Ù‹ (Ù„Ù„ØªØ¬Ø±Ø¨Ø© ÙÙ‚Ø·)</h3>
                        <p class="text-sm mb-2">ÙÙŠ Supabase Dashboard â†’ SQL EditorØŒ Ø´ØºÙ„:</p>
                        <pre class="bg-gray-900 p-3 rounded text-xs overflow-x-auto"><code>ALTER TABLE public.boards DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.columns DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.tasks DISABLE ROW LEVEL SECURITY;</code></pre>
                        <p class="text-sm mt-2 text-yellow-400">âš ï¸ Ù‡Ø°Ø§ Ù„Ù„ØªØ¬Ø±Ø¨Ø© ÙÙ‚Ø·! Ø£Ø¹Ø·Ù„ RLS ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬</p>
                    </div>
                    
                    <div class="bg-gray-700 p-4 rounded">
                        <h3 class="font-semibold mb-2 text-purple-400">3. Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ RLS</h3>
                        <pre class="bg-gray-900 p-3 rounded text-xs overflow-x-auto"><code>ALTER TABLE public.boards ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.columns ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.tasks ENABLE ROW LEVEL SECURITY;</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // Check environment variables
        const supabaseUrl = 'NEXT_PUBLIC_SUPABASE_URL' in window ? 'âœ… Ù…ÙˆØ¬ÙˆØ¯' : 'âŒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
        document.getElementById('supabase-url').innerHTML = supabaseUrl;
        document.getElementById('supabase-url').className = supabaseUrl.includes('âœ…') ? 'text-green-400' : 'text-red-400';

        // Load Clerk
        const clerkPubKey = 'pk_test_Y3VyaW91cy1tb2xsdXNrLTk2LmNsZXJrLmFjY291bnRzLmRldiQ';
        
        async function testClerkToken() {
            try {
                const clerk = window.Clerk;
                const session = await clerk.session.getToken({ template: 'supabase' });
                
                const tokenResult = document.getElementById('token-result');
                const tokenDetails = document.getElementById('token-details');
                tokenResult.classList.remove('hidden');
                
                if (session) {
                    document.getElementById('clerk-session').innerHTML = 'âœ… Ù†Ø´Ø·';
                    document.getElementById('clerk-session').className = 'text-green-400';
                    
                    document.getElementById('clerk-user-id').innerHTML = 'âœ… ' + clerk.user.id;
                    document.getElementById('clerk-user-id').className = 'text-green-400';
                    
                    tokenDetails.innerHTML = `
                        <div class="text-green-400 mb-2">âœ… ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ†</div>
                        <div>Ø§Ù„Ø·ÙˆÙ„: ${session.length} Ø­Ø±Ù</div>
                        <div>Ø§Ù„Ù†Ù…ÙˆØ°Ø¬: supabase</div>
                    `;
                } else {
                    document.getElementById('clerk-session').innerHTML = 'âŒ ØºÙŠØ± Ù†Ø´Ø·';
                    document.getElementById('clerk-session').className = 'text-red-400';
                    
                    document.getElementById('clerk-user-id').innerHTML = 'âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯';
                    document.getElementById('clerk-user-id').className = 'text-red-400';
                    
                    tokenDetails.innerHTML = `<div class="text-red-400">âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ†. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØªÙƒÙˆÙŠÙ† JWT template ÙÙŠ Clerk</div>`;
                }
            } catch (error) {
                document.getElementById('clerk-session').innerHTML = 'âŒ Ø®Ø·Ø£';
                document.getElementById('clerk-session').className = 'text-red-400';
                
                const tokenResult = document.getElementById('token-result');
                const tokenDetails = document.getElementById('token-details');
                tokenResult.classList.remove('hidden');
                tokenDetails.innerHTML = `<div class="text-red-400">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
            }
        }

        async function testSupabaseConnection() {
            const supabaseUrl = 'https://qiuitsoolbbnlnnjhluf.supabase.co';
            const supabaseKey = 'sb_publishable_sgjqn4gYMLUa1oblKowCVg_Vwi_Xpw4';
            
            try {
                const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
                
                const { data, error } = await supabase.from('boards').select('count');
                
                const resultDiv = document.getElementById('supabase-result');
                const detailsDiv = document.getElementById('supabase-details');
                resultDiv.classList.remove('hidden');
                
                if (error) {
                    document.getElementById('supabase-status').innerHTML = 'âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„';
                    document.getElementById('supabase-status').className = 'text-red-400';
                    
                    detailsDiv.innerHTML = `
                        <div class="text-red-400 mb-2">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>
                        <div>Ø§Ù„ÙƒÙˆØ¯: ${error.code}</div>
                        <div>Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${error.message}</div>
                        <div class="mt-2 text-yellow-400">ğŸ’¡ Ù‡Ø°Ø§ Ù‚Ø¯ ÙŠØ¹Ù†ÙŠ Ø£Ù† RLS ÙŠÙ…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„. Ø¬Ø±Ø¨ ØªØ¹Ø·ÙŠÙ„ RLS Ù…Ø¤Ù‚ØªØ§Ù‹</div>
                    `;
                } else {
                    document.getElementById('supabase-status').innerHTML = 'âœ… Ù…ØªØµÙ„';
                    document.getElementById('supabase-status').className = 'text-green-400';
                    
                    detailsDiv.innerHTML = `
                        <div class="text-green-400 mb-2">âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­!</div>
                        <div>Ø¹Ø¯Ø¯ Ø§Ù„Ù„ÙˆØ­Ø§Øª: ${data[0]?.count || 0}</div>
                    `;
                }
            } catch (error) {
                document.getElementById('supabase-status').innerHTML = 'âŒ Ø®Ø·Ø£';
                document.getElementById('supabase-status').className = 'text-red-400';
                
                const resultDiv = document.getElementById('supabase-result');
                const detailsDiv = document.getElementById('supabase-details');
                resultDiv.classList.remove('hidden');
                detailsDiv.innerHTML = `<div class="text-red-400">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
            }
        }

        // Initialize on load
        window.addEventListener('load', () => {
            document.getElementById('clerk-key').innerHTML = 'âœ… Ù…ÙˆØ¬ÙˆØ¯';
            document.getElementById('clerk-key').className = 'text-green-400';
            document.getElementById('supabase-key').innerHTML = 'âœ… Ù…ÙˆØ¬ÙˆØ¯';
            document.getElementById('supabase-key').className = 'text-green-400';
        });
    </script>
</body>
</html>
